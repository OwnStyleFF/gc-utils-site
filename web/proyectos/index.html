<!DOCTYPE html>
<html lang="es">
<head>
	<link rel="stylesheet" href="../style.css">
	<meta charset="UTF-8">
	<meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; connect-src 'self'; frame-ancestors 'none'; object-src 'none'; base-uri 'self'">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Proyectos - GC Utils</title>
	<link rel="stylesheet" href="../style.css">
	<style>
		header { background: #222; color: #fff; padding: 1rem 2rem; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; }
		#theme-switch-container { float: none !important; margin-top: 0; margin-right: 0; }
		@media (max-width: 700px) { header { flex-direction: column; align-items: flex-start; padding: 1rem; gap: 0.5rem; } #theme-switch-container { align-self: flex-end; margin-top: 0.5rem; margin-right: 0; } h1 { font-size: 1.5rem; } .subtitle { font-size: 1rem; } }
		@media (max-width: 700px) { .main-cards { gap: 1rem; } .main-card { width: 100%; max-width: 100%; } header { flex-direction: column; align-items: flex-start; padding: 1rem; } }
		@media (max-width: 500px) {
			.main-cards { flex-direction: column; align-items: center; gap: 0.75rem; margin-top: 1.5rem; }
			.main-card { width: 95%; max-width: 95vw; }
			.main-card img { height: 120px; }
			.main-card-title { font-size: 1rem; }
		}
		.theme-switch { position: relative; display: inline-block; width: 40px; height: 40px; }
		.theme-switch input { opacity: 0; width: 0; height: 0; }
		.slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background: transparent; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
		.theme-icon { font-size: 2rem; transition: color 0.3s; }
		.subtitle { font-size: 1.2rem; color: #ccc; margin-top: -0.5rem; }
		.main-cards { display: flex; justify-content: center; gap: 2rem; margin-top: 3rem; }
		.main-card { background: var(--card-bg, #fff); border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); width: 260px; text-decoration: none; color: var(--card-text, #222); overflow: hidden; display: flex; flex-direction: column; align-items: center; transition: box-shadow 0.2s, transform 0.2s; }
		.main-card:hover { box-shadow: 0 4px 16px rgba(0,0,0,0.15); transform: translateY(-4px) scale(1.03); }
		.main-card img { width: 100%; height: 160px; object-fit: cover; }
		.main-card-title { font-size: 1.2rem; font-weight: bold; margin: 1rem 0 1rem 0; text-align: center; }
		body { background: var(--bg, #f4f6fa); color: var(--text, #222); transition: background 0.3s, color 0.3s; }
		body.dark { --bg: #181a1b; --text: #eee; --card-bg: #23272b; --card-text: #eee; }
		body.light { --bg: #f4f6fa; --text: #222; --card-bg: #fff; --card-text: #222; }
	</style>
</head>
<body>
	<div id="galaxy-welcome" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(24,26,43,0.92);z-index:2000;align-items:center;justify-content:center;flex-direction:column;color:#fff;font-size:2rem;font-family:'Segoe UI',Arial,sans-serif;text-align:center;"></div>
	<canvas id="bg-canvas" style="position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:-1;"></canvas>
	<header>
		<h1>GC Utils</h1>
		<p class="subtitle">Un peque√±o espacio donde puedo compartir lo que pienso y lo que s√©.</p>
		<div id="theme-switch-container" style="float:right;margin-top:-2.5rem;margin-right:1rem;z-index:2;">
			<label class="theme-switch" style="z-index:2;">
				<input type="checkbox" id="theme-toggle" aria-label="Cambiar tema">
				<span class="slider" style="background:transparent;display:flex;align-items:center;justify-content:center;">
					<span class="icon theme-icon"></span>
				</span>
			</label>
		</div>
	</header>
	<main>
	<div class="main-cards" id="main-cards"></div>
	</main>
	<script>
		// Mensaje de bienvenida al llegar desde splash
		if (sessionStorage.getItem('fromSplash')) {
			const welcome = document.getElementById('galaxy-welcome');
			welcome.textContent = '¬°Bienvenido a la galaxia de Proyectos! üöÄ';
			welcome.style.display = 'flex';
			setTimeout(() => {
				welcome.style.display = 'none';
				sessionStorage.removeItem('fromSplash');
			}, 1800);
		}
		// Fondo animado: sistema solar, estrellas y meteoritos
		const canvas = document.getElementById('bg-canvas');
		const ctx = canvas.getContext('2d');
		function resizeCanvas() {
			canvas.width = window.innerWidth;
			canvas.height = window.innerHeight;
		}
		window.addEventListener('resize', resizeCanvas);
		resizeCanvas();

		// Estrellas
		const stars = Array.from({length: 120}, () => ({
			x: Math.random(),
			y: Math.random(),
			r: Math.random() * 1.2 + 0.5
		}));

		// Planetas (simplificado)
		const planets = [
			{r: 40, color: '#ffe066', orbit: 0.18, speed: 0.01}, // Sol
			{r: 10, color: '#b0b0b0', orbit: 70, speed: 0.03},   // Mercurio
			{r: 14, color: '#f7c59f', orbit: 110, speed: 0.022}, // Venus
			{r: 16, color: '#6ec6ff', orbit: 150, speed: 0.018}, // Tierra
			{r: 12, color: '#ff6f61', orbit: 190, speed: 0.015}, // Marte
			{r: 28, color: '#ffe0b2', orbit: 240, speed: 0.012}, // J√∫piter
			{r: 24, color: '#bdbdbd', orbit: 290, speed: 0.009}, // Saturno
			{r: 18, color: '#90caf9', orbit: 340, speed: 0.007}, // Urano
			{r: 16, color: '#b39ddb', orbit: 380, speed: 0.005}  // Neptuno
		];
		let planetAngles = planets.map(() => Math.random() * Math.PI * 2);

		// Meteoritos
		const meteors = Array.from({length: 4}, () => ({
			x: Math.random() * canvas.width,
			y: Math.random() * canvas.height,
			vx: Math.random() * 4 + 2,
			vy: Math.random() * 2 - 1,
			len: Math.random() * 60 + 40
		}));

		function drawSolarSystem() {
			ctx.clearRect(0, 0, canvas.width, canvas.height);
			// Fondo
			ctx.fillStyle = '#181a2b';
			ctx.fillRect(0, 0, canvas.width, canvas.height);
			// Estrellas
			ctx.save();
			ctx.globalAlpha = 0.8;
			stars.forEach(s => {
				ctx.beginPath();
				ctx.arc(s.x * canvas.width, s.y * canvas.height, s.r, 0, Math.PI * 2);
				ctx.fillStyle = '#fff';
				ctx.fill();
			});
			ctx.restore();
			// Sol y planetas
			const cx = canvas.width / 2;
			const cy = canvas.height / 2;
			planets.forEach((p, i) => {
				let angle = planetAngles[i];
				let px = cx + Math.cos(angle) * (p.orbit || 0);
				let py = cy + Math.sin(angle) * (p.orbit || 0);
				ctx.beginPath();
				ctx.arc(px, py, p.r, 0, Math.PI * 2);
				ctx.fillStyle = p.color;
				ctx.shadowColor = p.color;
				ctx.shadowBlur = i === 0 ? 30 : 10;
				ctx.fill();
				ctx.shadowBlur = 0;
			});
			// √ìrbitas
			ctx.strokeStyle = 'rgba(255,255,255,0.08)';
			planets.forEach((p, i) => {
				if (i > 0) {
					ctx.beginPath();
					ctx.arc(cx, cy, p.orbit, 0, Math.PI * 2);
					ctx.stroke();
				}
			});
			// Meteoritos
			meteors.forEach(m => {
				ctx.save();
				ctx.beginPath();
				ctx.moveTo(m.x, m.y);
				ctx.lineTo(m.x - m.len, m.y + m.len * 0.2);
				ctx.strokeStyle = '#fff';
				ctx.lineWidth = 2.5;
				ctx.shadowColor = '#fff';
				ctx.shadowBlur = 8;
				ctx.stroke();
				ctx.restore();
			});
		}

		function animateSolarSystem() {
			planetAngles = planetAngles.map((a, i) => a + planets[i].speed);
			meteors.forEach(m => {
				m.x += m.vx;
				m.y += m.vy;
				if (m.x > canvas.width + 40 || m.y > canvas.height + 40 || m.y < -40) {
					m.x = -60;
					m.y = Math.random() * canvas.height * 0.8;
					m.vx = Math.random() * 4 + 2;
					m.vy = Math.random() * 2 - 1;
					m.len = Math.random() * 60 + 40;
				}
			});
			drawSolarSystem();
			requestAnimationFrame(animateSolarSystem);
		}
		animateSolarSystem();
		// Theme logic moved to centralized script

		fetch('proyectos.json')
			.then(res => res.json())
			.then(data => {
				const container = document.getElementById('main-cards');
				while (container.firstChild) container.removeChild(container.firstChild);
				data.forEach(item => {
					const card = document.createElement('a');
					card.className = 'main-card';
					card.target = '_self';
					if (item.titulo === 'Proyectos GC') {
						card.href = 'ProyectosGC/index.html';
					} else if (item.titulo === 'Portafolio documentado de proyectos desarrollados') {
						card.href = 'PortafolioDocumentadoDeProyectosDesarrollados/index.html';
					} else {
						card.href = '#';
					}

					const img = document.createElement('img');
					img.src = item.imagen || '';
					img.alt = item.titulo || '';
					img.loading = 'lazy';

					const title = document.createElement('div');
					title.className = 'main-card-title';
					title.textContent = item.titulo || '';

					card.appendChild(img);
					card.appendChild(title);
					container.appendChild(card);
				});
			});
		// Bot√≥n flotante para volver a la p√°gina principal
		const btnFloatHome = document.createElement('a');
		btnFloatHome.href = '#';
		btnFloatHome.className = 'btn-float-home';
		btnFloatHome.textContent = 'üè†';
		btnFloatHome.onclick = function(e) {
			e.preventDefault();
			window.location.href = '../splash-bienvenida.html';
		};
		document.body.appendChild(btnFloatHome);
	</script>
	<script src="../theme-toggle.js"></script>
	<script>
		(function(){
			const CHECK_INTERVAL = 50;
			const TIMEOUT = 500;
			let waited = 0;
			function installFallback(){
				console.log('[fallback] installing local fallback (poll timeout)');
				const toggle = document.getElementById('theme-toggle');
				const icons = Array.from(document.querySelectorAll('.theme-icon'));
				function apply(mode){
					document.body.classList.remove('light','dark');
					document.body.classList.add(mode);
					icons.forEach(ic => ic.textContent = mode === 'dark' ? 'üåô' : 'üåû');
					try { localStorage.setItem('theme', mode); } catch(e){}
				}
				let saved = null;
				try { saved = localStorage.getItem('theme'); } catch(e){ saved = null; }
				if (saved === 'dark' || saved === 'light') apply(saved); else {
					const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
					apply(prefersDark ? 'dark' : 'light');
				}
				if (toggle) {
					toggle.checked = document.body.classList.contains('dark');
					toggle.addEventListener('change', function(){ apply(toggle.checked ? 'dark' : 'light'); });
					icons.forEach(ic => ic.addEventListener('click', function(){ toggle.checked = !toggle.checked; apply(toggle.checked ? 'dark' : 'light'); }));
				}
			}
			function check(){
				if (window.__themeToggleInitialized) return;
				waited += CHECK_INTERVAL;
				if (waited >= TIMEOUT){ installFallback(); return; }
				setTimeout(check, CHECK_INTERVAL);
			}
			setTimeout(check, CHECK_INTERVAL);
		})();
	</script>
</body>
</html>